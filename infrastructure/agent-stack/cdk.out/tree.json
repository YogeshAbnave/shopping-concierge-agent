{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.225.0"},"children":{"AgentStack-shopping-v3":{"id":"AgentStack-shopping-v3","path":"AgentStack-shopping-v3","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.225.0"},"children":{"ImportedUserPool":{"id":"ImportedUserPool","path":"AgentStack-shopping-v3/ImportedUserPool","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.225.0","metadata":[]}},"OAuthProviderLambdaRole":{"id":"OAuthProviderLambdaRole","path":"AgentStack-shopping-v3/OAuthProviderLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.225.0","metadata":[]},"children":{"ImportOAuthProviderLambdaRole":{"id":"ImportOAuthProviderLambdaRole","path":"AgentStack-shopping-v3/OAuthProviderLambdaRole/ImportOAuthProviderLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.225.0","metadata":[]}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/OAuthProviderLambdaRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Execution role for OAuth Provider Custom Resource Lambda","managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"policies":[{"policyName":"OAuthProviderPolicy","policyDocument":{"Statement":[{"Action":["bedrock-agentcore:CreateOAuth2CredentialProvider","bedrock-agentcore:CreateTokenVault","bedrock-agentcore:DeleteOAuth2CredentialProvider","bedrock-agentcore:DeleteTokenVault","bedrock-agentcore:GetOAuth2CredentialProvider","bedrock-agentcore:GetTokenVault","bedrock-agentcore:ListOAuth2CredentialProviders","cognito-idp:DescribeUserPoolClient","secretsmanager:CreateSecret","secretsmanager:DeleteSecret","secretsmanager:GetSecretValue","secretsmanager:PutSecretValue"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}}],"tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}]}}}}},"OAuthProviderLambda":{"id":"OAuthProviderLambda","path":"AgentStack-shopping-v3/OAuthProviderLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.225.0","metadata":[]},"children":{"Code":{"id":"Code","path":"AgentStack-shopping-v3/OAuthProviderLambda/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.225.0"},"children":{"Stage":{"id":"Stage","path":"AgentStack-shopping-v3/OAuthProviderLambda/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.225.0"}},"AssetBucket":{"id":"AssetBucket","path":"AgentStack-shopping-v3/OAuthProviderLambda/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.225.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/OAuthProviderLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-998461587244-us-east-1","s3Key":"b8083d29dda73704c16f5905e13b369e402dde3721c2caa358950e20b92d2b1a.zip"},"description":"Custom Resource for OAuth2 Credential Provider management","handler":"index.handler","role":{"Fn::GetAtt":["OAuthProviderLambdaRole178E2673","Arn"]},"runtime":"python3.13","tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}],"timeout":300}}}}},"OAuthProvider":{"id":"OAuthProvider","path":"AgentStack-shopping-v3/OAuthProvider","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.Provider","version":"2.225.0"},"children":{"framework-onEvent":{"id":"framework-onEvent","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.225.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.225.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.225.0","metadata":[]}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.225.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["OAuthProviderLambda5411C102","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["OAuthProviderLambda5411C102","Arn"]},":*"]]}]},{"Action":"lambda:GetFunction","Effect":"Allow","Resource":{"Fn::GetAtt":["OAuthProviderLambda5411C102","Arn"]}}],"Version":"2012-10-17"},"policyName":"OAuthProviderframeworkonEventServiceRoleDefaultPolicy07D767F2","roles":[{"Ref":"OAuthProviderframeworkonEventServiceRoleC52D6B54"}]}}}}}}},"Code":{"id":"Code","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.225.0"},"children":{"Stage":{"id":"Stage","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.225.0"}},"AssetBucket":{"id":"AssetBucket","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.225.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/OAuthProvider/framework-onEvent/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-998461587244-us-east-1","s3Key":"bdc104ed9cab1b5b6421713c8155f0b753380595356f710400609664d3635eca.zip"},"description":"AWS CDK resource provider framework - onEvent (AgentStack-shopping-v3/OAuthProvider)","environment":{"variables":{"USER_ON_EVENT_FUNCTION_ARN":{"Fn::GetAtt":["OAuthProviderLambda5411C102","Arn"]}}},"handler":"framework.onEvent","loggingConfig":{"logFormat":"JSON","applicationLogLevel":"FATAL"},"role":{"Fn::GetAtt":["OAuthProviderframeworkonEventServiceRoleC52D6B54","Arn"]},"runtime":"nodejs22.x","tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}],"timeout":900}}}}}}},"OAuthCredentialProvider":{"id":"OAuthCredentialProvider","path":"AgentStack-shopping-v3/OAuthCredentialProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.225.0","metadata":[]},"children":{"Default":{"id":"Default","path":"AgentStack-shopping-v3/OAuthCredentialProvider/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.225.0"}}}},"Memory":{"id":"Memory","path":"AgentStack-shopping-v3/Memory","constructInfo":{"fqn":"@aws-cdk/aws-bedrock-agentcore-alpha.Memory","version":"2.225.0-alpha.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AgentStack-shopping-v3/Memory/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.225.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AgentStack-shopping-v3/Memory/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.225.0","metadata":[]}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/Memory/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"bedrock-agentcore.amazonaws.com"}}],"Version":"2012-10-17"},"tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}]}}}}},"Memory":{"id":"Memory","path":"AgentStack-shopping-v3/Memory/Memory","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrockagentcore.CfnMemory","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::BedrockAgentCore::Memory","aws:cdk:cloudformation:props":{"tags":{"DeploymentId":"shopping-v3","DeploymentName":"shopping-v3"},"description":"Short-term memory for Concierge Agent","eventExpiryDuration":90,"memoryExecutionRoleArn":{"Fn::GetAtt":["MemoryServiceRoleC95D1642","Arn"]},"name":"memory_agentstack_shopping_v3"}}}}},"AgentRole":{"id":"AgentRole","path":"AgentStack-shopping-v3/AgentRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.225.0","metadata":[]},"children":{"ImportAgentRole":{"id":"ImportAgentRole","path":"AgentStack-shopping-v3/AgentRole/ImportAgentRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.225.0","metadata":[]}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/AgentRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"bedrock-agentcore.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Execution role for Concierge Agent","tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AgentStack-shopping-v3/AgentRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.225.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/AgentRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:DeleteItem","dynamodb:GetItem","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:aws:dynamodb:us-east-1:998461587244:table/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-FeedbackTableName"},"/index/*"]]},{"Fn::Join":["",["arn:aws:dynamodb:us-east-1:998461587244:table/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-FeedbackTableName"}]]},{"Fn::Join":["",["arn:aws:dynamodb:us-east-1:998461587244:table/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-UserProfileTableName"},"/index/*"]]},{"Fn::Join":["",["arn:aws:dynamodb:us-east-1:998461587244:table/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-UserProfileTableName"}]]},{"Fn::Join":["",["arn:aws:dynamodb:us-east-1:998461587244:table/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-WishlistTableName"},"/index/*"]]},{"Fn::Join":["",["arn:aws:dynamodb:us-east-1:998461587244:table/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-WishlistTableName"}]]}]},{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:DescribeLogGroups","logs:DescribeLogStreams","logs:FilterLogEvents","logs:GetLogEvents","logs:PutLogEvents"],"Effect":"Allow","Resource":"arn:aws:logs:us-east-1:998461587244:log-group:*"},{"Action":["bedrock-agentcore:CreateEvent","bedrock-agentcore:GetEvent","bedrock-agentcore:GetMemory","bedrock-agentcore:ListEvents","bedrock-agentcore:ListMemories","bedrock-agentcore:RetrieveMemoryRecords"],"Effect":"Allow","Resource":{"Fn::GetAtt":["Memory3232ACAB","MemoryArn"]}},{"Action":["bedrock:InvokeModel","bedrock:InvokeModelWithResponseStream"],"Effect":"Allow","Resource":["arn:aws:bedrock:*:998461587244:inference-profile/*","arn:aws:bedrock:*::foundation-model/*"]},{"Action":["bedrock-agentcore:InvokeGateway","ecr:BatchCheckLayerAvailability","ecr:BatchGetImage","ecr:GetAuthorizationToken","ecr:GetDownloadUrlForLayer"],"Effect":"Allow","Resource":"*"},{"Action":["cognito-idp:DescribeUserPool","cognito-idp:DescribeUserPoolClient"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:cognito-idp:us-east-1:998461587244:userpool/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-UserPoolId"}]]}},{"Action":["logs:CreateLogGroup","logs:DescribeLogStreams"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:us-east-1:998461587244:log-group:/aws/bedrock-agentcore/runtimes/*"]]},"Sid":"LogGroupAccess"},{"Action":"logs:DescribeLogGroups","Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:us-east-1:998461587244:log-group:*"]]},"Sid":"DescribeLogGroups"},{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:us-east-1:998461587244:log-group:/aws/bedrock-agentcore/runtimes/*:log-stream:*"]]},"Sid":"LogStreamAccess"},{"Action":["xray:GetSamplingRules","xray:GetSamplingTargets","xray:PutTelemetryRecords","xray:PutTraceSegments"],"Effect":"Allow","Resource":"*","Sid":"XRayAccess"},{"Action":"cloudwatch:PutMetricData","Condition":{"StringEquals":{"cloudwatch:namespace":"bedrock-agentcore"}},"Effect":"Allow","Resource":"*","Sid":"CloudWatchMetrics"},{"Action":["bedrock-agentcore:GetWorkloadAccessToken","bedrock-agentcore:GetWorkloadAccessTokenForJWT","bedrock-agentcore:GetWorkloadAccessTokenForUserId"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":bedrock-agentcore:us-east-1:998461587244:workload-identity-directory/default"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":bedrock-agentcore:us-east-1:998461587244:workload-identity-directory/default/workload-identity/*"]]}],"Sid":"GetAgentAccessToken"},{"Action":"ssm:GetParameter","Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":ssm:us-east-1:998461587244:parameter",{"Ref":"GatewayUrlParameter3DD1F504"}]]}},{"Action":["ecr:BatchCheckLayerAvailability","ecr:BatchGetImage","ecr:GetDownloadUrlForLayer"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":ecr:us-east-1:998461587244:repository/cdk-hnb659fds-container-assets-998461587244-us-east-1"]]}}],"Version":"2012-10-17"},"policyName":"AgentRoleDefaultPolicy1027F5D2","roles":[{"Ref":"AgentRoleF4A42D6B"}]}}}}}}},"Runtime":{"id":"Runtime","path":"AgentStack-shopping-v3/Runtime","constructInfo":{"fqn":"@aws-cdk/aws-bedrock-agentcore-alpha.Runtime","version":"2.225.0-alpha.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/Runtime/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrockagentcore.CfnRuntime","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::BedrockAgentCore::Runtime","aws:cdk:cloudformation:props":{"agentRuntimeArtifact":{"containerConfiguration":{"containerUri":{"Fn::Sub":"998461587244.dkr.ecr.us-east-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-998461587244-us-east-1:152e084fa2d1cc8730b55a863e05fbc56dfe6de4e22c4464392097da9385d955"}}},"agentRuntimeName":"agent_agentstack_shopping_v3","authorizerConfiguration":{"customJwtAuthorizer":{"discoveryUrl":{"Fn::Join":["",["https://cognito-idp.",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-Region"},".amazonaws.com/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-UserPoolId"},"/.well-known/openid-configuration"]]},"allowedClients":[{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-ClientId"}]}},"tags":{"DeploymentId":"shopping-v3","DeploymentName":"shopping-v3"},"description":"Concierge Agent Runtime","environmentVariables":{"MEMORY_ID":{"Fn::GetAtt":["Memory3232ACAB","MemoryId"]},"USER_PROFILE_TABLE_NAME":{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-UserProfileTableName"},"WISHLIST_TABLE_NAME":{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-WishlistTableName"},"FEEDBACK_TABLE_NAME":{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Data-FeedbackTableName"},"DEPLOYMENT_ID":"shopping-v3","GATEWAY_CLIENT_ID":{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-MachineClientId"},"GATEWAY_USER_POOL_ID":{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-UserPoolId"},"GATEWAY_SCOPE":"concierge-gateway/invoke"},"networkConfiguration":{"networkMode":"PUBLIC"},"protocolConfiguration":"HTTP","roleArn":{"Fn::GetAtt":["AgentRoleF4A42D6B","Arn"]}}}},"AgentRuntimeArtifacte322be90c89b274584dc048e4a647cb9":{"id":"AgentRuntimeArtifacte322be90c89b274584dc048e4a647cb9","path":"AgentStack-shopping-v3/Runtime/AgentRuntimeArtifacte322be90c89b274584dc048e4a647cb9","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr_assets.DockerImageAsset","version":"2.225.0"},"children":{"Staging":{"id":"Staging","path":"AgentStack-shopping-v3/Runtime/AgentRuntimeArtifacte322be90c89b274584dc048e4a647cb9/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.225.0"}},"Repository":{"id":"Repository","path":"AgentStack-shopping-v3/Runtime/AgentRuntimeArtifacte322be90c89b274584dc048e4a647cb9/Repository","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.225.0","metadata":[]}}}}}},"Gateway":{"id":"Gateway","path":"AgentStack-shopping-v3/Gateway","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"GatewayRole":{"id":"GatewayRole","path":"AgentStack-shopping-v3/Gateway/GatewayRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.225.0","metadata":[]},"children":{"ImportGatewayRole":{"id":"ImportGatewayRole","path":"AgentStack-shopping-v3/Gateway/GatewayRole/ImportGatewayRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.225.0","metadata":[]}},"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/Gateway/GatewayRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"bedrock-agentcore.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Execution role for AgentCore Gateway","policies":[{"policyName":"GatewayPolicy","policyDocument":{"Statement":[{"Action":["bedrock-agentcore:InvokeRuntime","bedrock-agentcore:InvokeRuntimeWithResponseStream"],"Effect":"Allow","Resource":[{"Fn::ImportValue":"CartStack-shopping-v3-RuntimeArn"},{"Fn::ImportValue":"ShoppingStack-shopping-v3-RuntimeArn"}],"Sid":"BedrockAgentCoreAccess"},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":"arn:aws:lambda:us-east-1:998461587244:function:*","Sid":"LambdaInvokeAccess"},{"Action":["bedrock:InvokeModel","bedrock:InvokeModelWithResponseStream"],"Effect":"Allow","Resource":["arn:aws:bedrock:*:998461587244:inference-profile/*","arn:aws:bedrock:*::foundation-model/*"],"Sid":"BedrockModelAccess"},{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":"arn:aws:logs:us-east-1:998461587244:log-group:/aws/bedrock-agentcore/*","Sid":"CloudWatchLogsAccess"},{"Action":["bedrock-agentcore:GetOAuth2CredentialProvider","bedrock-agentcore:GetResourceOauth2Token","bedrock-agentcore:GetTokenVault","bedrock-agentcore:GetWorkloadAccessToken","secretsmanager:GetSecretValue"],"Effect":"Allow","Resource":["arn:aws:bedrock-agentcore:us-east-1:998461587244:token-vault/*","arn:aws:bedrock-agentcore:us-east-1:998461587244:workload-identity-directory/*","arn:aws:secretsmanager:us-east-1:998461587244:secret:*",{"Fn::GetAtt":["OAuthCredentialProvider","ProviderArn"]}],"Sid":"OAuthProviderAccess"}],"Version":"2012-10-17"}}],"tags":[{"key":"DeploymentId","value":"shopping-v3"},{"key":"DeploymentName","value":"shopping-v3"}]}}}}},"Gateway":{"id":"Gateway","path":"AgentStack-shopping-v3/Gateway/Gateway","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrockagentcore.CfnGateway","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::BedrockAgentCore::Gateway","aws:cdk:cloudformation:props":{"authorizerConfiguration":{"customJwtAuthorizer":{"allowedClients":[{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-MachineClientId"}],"discoveryUrl":{"Fn::Join":["",["https://cognito-idp.",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-Region"},".amazonaws.com/",{"Fn::ImportValue":"ConciergeAgent-shopping-v3-Auth-UserPoolId"},"/.well-known/openid-configuration"]]}}},"authorizerType":"CUSTOM_JWT","tags":{"DeploymentId":"shopping-v3","DeploymentName":"shopping-v3"},"description":"AgentCore Gateway with MCP protocol, JWT inbound auth, and OAuth outbound auth","name":"gateway-agentstack-shopping-v3","protocolConfiguration":{"mcp":{"supportedVersions":["2025-03-26"]}},"protocolType":"MCP","roleArn":{"Fn::GetAtt":["GatewayGatewayRole270B0532","Arn"]}}}},"McpTarget0":{"id":"McpTarget0","path":"AgentStack-shopping-v3/Gateway/McpTarget0","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrockagentcore.CfnGatewayTarget","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::BedrockAgentCore::GatewayTarget","aws:cdk:cloudformation:props":{"credentialProviderConfigurations":[{"credentialProviderType":"OAUTH","credentialProvider":{"oauthCredentialProvider":{"providerArn":{"Fn::GetAtt":["OAuthCredentialProvider","ProviderArn"]},"scopes":["concierge-gateway/invoke"]}}}],"description":"MCP Server: CartTools","gatewayIdentifier":{"Fn::GetAtt":["GatewayBCF9E5FF","GatewayIdentifier"]},"name":"carttools","targetConfiguration":{"mcp":{"mcpServer":{"endpoint":{"Fn::Join":["",["https://bedrock-agentcore.us-east-1.amazonaws.com/runtimes/",{"Fn::Join":["%2F",{"Fn::Split":["/",{"Fn::Join":["%3A",{"Fn::Split":[":",{"Fn::ImportValue":"CartStack-shopping-v3-RuntimeArn"}]}]}]}]},"/invocations"]]}}}}}}},"McpTarget1":{"id":"McpTarget1","path":"AgentStack-shopping-v3/Gateway/McpTarget1","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrockagentcore.CfnGatewayTarget","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::BedrockAgentCore::GatewayTarget","aws:cdk:cloudformation:props":{"credentialProviderConfigurations":[{"credentialProviderType":"OAUTH","credentialProvider":{"oauthCredentialProvider":{"providerArn":{"Fn::GetAtt":["OAuthCredentialProvider","ProviderArn"]},"scopes":["concierge-gateway/invoke"]}}}],"description":"MCP Server: ShoppingTools","gatewayIdentifier":{"Fn::GetAtt":["GatewayBCF9E5FF","GatewayIdentifier"]},"name":"shoppingtools","targetConfiguration":{"mcp":{"mcpServer":{"endpoint":{"Fn::Join":["",["https://bedrock-agentcore.us-east-1.amazonaws.com/runtimes/",{"Fn::Join":["%2F",{"Fn::Split":["/",{"Fn::Join":["%3A",{"Fn::Split":[":",{"Fn::ImportValue":"ShoppingStack-shopping-v3-RuntimeArn"}]}]}]}]},"/invocations"]]}}}}}}}}},"GatewayUrlParameter":{"id":"GatewayUrlParameter","path":"AgentStack-shopping-v3/GatewayUrlParameter","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.225.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"AgentStack-shopping-v3/GatewayUrlParameter/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.225.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"description":"AgentCore Gateway URL for supervisor agent","name":"/concierge-agent/shopping-v3/gateway-url","tags":{"DeploymentId":"shopping-v3","DeploymentName":"shopping-v3"},"tier":"Standard","type":"String","value":{"Fn::GetAtt":["GatewayBCF9E5FF","GatewayUrl"]}}}}}},"MainRuntimeArn":{"id":"MainRuntimeArn","path":"AgentStack-shopping-v3/MainRuntimeArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"MainRuntimeId":{"id":"MainRuntimeId","path":"AgentStack-shopping-v3/MainRuntimeId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"MemoryId":{"id":"MemoryId","path":"AgentStack-shopping-v3/MemoryId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"GatewayUrl":{"id":"GatewayUrl","path":"AgentStack-shopping-v3/GatewayUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"GatewayId":{"id":"GatewayId","path":"AgentStack-shopping-v3/GatewayId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"GatewayArn":{"id":"GatewayArn","path":"AgentStack-shopping-v3/GatewayArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"GatewayTargetCount":{"id":"GatewayTargetCount","path":"AgentStack-shopping-v3/GatewayTargetCount","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"MachineClientId":{"id":"MachineClientId","path":"AgentStack-shopping-v3/MachineClientId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"OAuthProviderArn":{"id":"OAuthProviderArn","path":"AgentStack-shopping-v3/OAuthProviderArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.225.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"AgentStack-shopping-v3/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"AgentStack-shopping-v3/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.225.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"AgentStack-shopping-v3/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.225.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"AgentStack-shopping-v3/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.225.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"}}}}}